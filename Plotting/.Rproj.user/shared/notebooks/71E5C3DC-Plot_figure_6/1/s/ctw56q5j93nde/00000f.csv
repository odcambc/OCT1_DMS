"0","# Map Kir2.1 position numbering to Kir2.2, for mapping"
"0","alignment_cotypes = ""cccccciiciciiciiinniccciciiciciciciicicici"""
"0",""
"0","kir_alignment <- read_csv(""IRK_alignment_master_updated230622.csv"","
"0","                          col_types = alignment_cotypes)"
"0",""
"0","kir_alignment <- kir_alignment %>% mutate(MD_prob = exp(-MD),"
"0","                         MI_prob = exp(-MI))"
"0",""
"0","aligned_kir_scores <- full_join(kir_scores, kir_alignment,"
"0","                            by = c('pos' = 'Kir2_1_FLAG_Resno_mus'),"
"0","                            keep = TRUE)"
"0",""
"0","aligned_kir_scores_summarized <- aligned_kir_scores %>% group_by(pos) %>%"
"0","  summarise(avg_S = mean(S_score, na.rm=TRUE),"
"0","            avg_A = mean(A_score, na.rm=TRUE), "
"0","            avg_SA = mean(SA_score, na.rm=TRUE),"
"0","            max_S = max(SA_score, na.rm=TRUE),"
"0","            max_A = max(A_score, na.rm=TRUE),"
"0","            min_S = min(SA_score, na.rm=TRUE),"
"0","            min_A = min(A_score, na.rm=TRUE),"
"0","            Kir2_2_Resno_3SPI = first(Kir2_2_Resno_3SPI),"
"0","            IRK_C_PF08466 = first(IRK_C_PF08466),"
"0","            IRK_PF01007 = first(IRK_PF01007),"
"0","            IRK_N_PF08466 = first(IRK_N_PF08466))"
"2","Warning: no non-missing arguments to max; returning -Inf"
"2","Warning: no non-missing arguments to max; returning -Inf"
"2","Warning: no non-missing arguments to min; returning Inf"
"2","Warning: no non-missing arguments to min; returning Inf"
"0","aligned_kir_scores_summarized <- merge(aligned_kir_scores_summarized, aligned_kir_scores %>% filter(mutation_type == ""M"") %>% group_by(pos) %>%"
"0","  summarise(avg_S_M = mean(S_score, na.rm=TRUE),"
"0","            max_S_M = max(SA_score, na.rm=TRUE),"
"0","            min_S_M = min(SA_score, na.rm=TRUE)),"
"0","  by.x = 'pos',"
"0","  by.y = 'pos',"
"0","  all.x = TRUE,"
"0","  all.y = TRUE)"
"0",""
"0","aligned_kir_scores_summarized <- merge(aligned_kir_scores_summarized, aligned_kir_scores %>% filter(mutation_type == ""D"") %>% group_by(pos) %>%"
"0","  summarise(avg_S_D = mean(S_score, na.rm=TRUE),"
"0","            max_S_D = max(SA_score, na.rm=TRUE),"
"0","            min_S_D = min(SA_score, na.rm=TRUE)),"
"0","  by.x = 'pos',"
"0","  by.y = 'pos',"
"0","  all.x = TRUE,"
"0","  all.y = TRUE)"
"0",""
"0","aligned_kir_scores_summarized <- merge(aligned_kir_scores_summarized, aligned_kir_scores %>% filter(mutation_type == ""I"") %>% group_by(pos) %>%"
"0","  summarise(avg_S_I = mean(S_score, na.rm=TRUE),"
"0","            max_S_I = max(SA_score, na.rm=TRUE),"
"0","            min_S_I = min(SA_score, na.rm=TRUE)),"
"0","  by.x = 'pos',"
"0","  by.y = 'pos',"
"0","  all.x = TRUE,"
"0","  all.y = TRUE)"
"0",""
"0","aligned_kir_scores_summarized <- merge(aligned_kir_scores_summarized, aligned_kir_scores %>% filter(mutation_type == ""I"" & len == 1) %>% group_by(pos) %>% summarise(S_I1 = mean(S_score, na.rm=TRUE)),"
"0","  by.x = 'pos',"
"0","  by.y = 'pos',"
"0","  all.x = TRUE,"
"0","  all.y = TRUE)"
"0",""
"0","aligned_kir_scores_summarized <- merge(aligned_kir_scores_summarized, aligned_kir_scores %>% filter(mutation_type == ""I"" & len == 2) %>% group_by(pos) %>% summarise(S_I2 = mean(S_score, na.rm=TRUE)),"
"0","  by.x = 'pos',"
"0","  by.y = 'pos',"
"0","  all.x = TRUE,"
"0","  all.y = TRUE)"
"0",""
"0","aligned_kir_scores_summarized <- merge(aligned_kir_scores_summarized, aligned_kir_scores %>% filter(mutation_type == ""I"" & len == 3) %>% group_by(pos) %>% summarise(S_I3 = mean(S_score, na.rm=TRUE)),"
"0","  by.x = 'pos',"
"0","  by.y = 'pos',"
"0","  all.x = TRUE,"
"0","  all.y = TRUE)"
"0",""
"0","aligned_kir_scores_summarized <- merge(aligned_kir_scores_summarized, aligned_kir_scores %>% filter(mutation_type == ""D"" & len == 1) %>% group_by(pos) %>% summarise(S_D1 = mean(S_score, na.rm=TRUE)),"
"0","  by.x = 'pos',"
"0","  by.y = 'pos',"
"0","  all.x = TRUE,"
"0","  all.y = TRUE)"
"0",""
"0","aligned_kir_scores_summarized <- merge(aligned_kir_scores_summarized, aligned_kir_scores %>% filter(mutation_type == ""D"" & len == 2) %>% group_by(pos) %>% summarise(S_D2 = mean(S_score, na.rm=TRUE)),"
"0","  by.x = 'pos',"
"0","  by.y = 'pos',"
"0","  all.x = TRUE,"
"0","  all.y = TRUE)"
"0",""
"0","aligned_kir_scores_summarized <- merge(aligned_kir_scores_summarized, aligned_kir_scores %>% filter(mutation_type == ""D"" & len == 3) %>% group_by(pos) %>% summarise(S_D3 = mean(S_score, na.rm=TRUE)),"
"0","  by.x = 'pos',"
"0","  by.y = 'pos',"
"0","  all.x = TRUE,"
"0","  all.y = TRUE)"
"0",""
"0","kir21_3spi_pdb <- read.pdb(""Structures/3spi.pdb"")"
"0",""
"0","sse_3spi <- dssp(kir21_3spi_pdb, exefile = ""dssp"", resno=TRUE, full=FALSE, verbose=FALSE)"
"2","/usr/local/bin/mkdssp
"
"2","Warning: Non-protein residues detected in input PDB: K, PIO"
"0","sse_list <- data.frame(Kir2_2_Resno_3SPI = strtoi(str_extract(names(sse_3spi$sse), ""^[0-9]+"")), SS = sse_3spi$sse)"
"0",""
"0","# Add the N and C-termini as pseudo-SS"
"0","sse_list <- full_join(sse_list, full_join(data.frame(Kir2_2_Resno_3SPI=1:40, SS=""Nt""), data.frame(Kir2_2_Resno_3SPI=373:423, SS=""Ct"")), on=pos)"
"2","Joining, by = c(""Kir2_2_Resno_3SPI"", ""SS"")"
"2","Joining, by = c(""Kir2_2_Resno_3SPI"", ""SS"")"
"0","aligned_kir_scores <- full_join(sse_list, aligned_kir_scores,"
"0","                                by = 'Kir2_2_Resno_3SPI',"
"0","                                keep = FALSE)"
"0",""
"0","pfam_scores <- aligned_kir_scores %>% group_by(Kir2_1_FLAG_Resno_mus) %>%"
"0","  summarize(Kir2_1_FLAG_Resno_mus = first(Kir2_1_FLAG_Resno_mus), MD = first(MD_prob), MI = first(MI_prob)) %>%"
"0","  pivot_longer(cols=starts_with(""M""),"
"0","               names_to = ""mutation_type"","
"0","               names_prefix=""M"") %>%"
"0","  mutate(value = value)"
"0",""
"0",""
"0",""
